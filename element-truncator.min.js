$.fn.extend({truncateToElements:function(f){var a=this,b=$.extend({child_selector:!1,truncate_to:6,animation_duration:500,button_class:"collapse_button",button_element:"<div/>",button_text_expand:"Show all",button_text_collapse:"Collapse",control_class:"collapse_control",control_element:"<div/>",wrapper_collapsed_class:"collapsed",csstransitions:!1},f),c=b.child_selector?a.find(b.child_selector):a.children();if(!(1>b.truncate_to||c.length<=b.truncate_to)){var e=function(a){return a.position().top+
a.outerHeight(!0)-parseInt(a.css("marginTop"),10)},h=$(c[b.truncate_to-1]);a.css({height:e(h)}).data("collapsed",!0).addClass(b.wrapper_collapsed_class);var d=c.slice(b.truncate_to);d.hide();f=$(b.button_element).addClass(b.button_class).text(b.button_text_expand);$(b.control_element).addClass(b.control_class).insertAfter(this).append(f);if(b.csstransitions){var m=c.css("display"),k=function(){d.css({opacity:0});a.css({height:a.height()});a.css({height:e(h)})},l=function(){a.css({height:a.height()});
d.css({display:m});a.css({height:e(c.last())});d.css({opacity:1})},g=function(b){if(event.target==this)switch(a.data("collapsed")){case !0:d.css({display:"none"});a.css({height:"auto"});a.trigger("afterCollapse");break;case !1:a.css({height:"auto"}),a.trigger("afterExpand")}};a.css({transition:"height "+b.animation_duration+"ms"});d.css({opacity:0});c.css({transition:"opacity "+b.animation_duration+"ms"});a.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",g)}else k=
function(){a.animate({height:e(h)},b.animation_duration,g);d.fadeOut(0.9*b.animation_duration)},l=function(){c.fadeIn(0.9*b.animation_duration);a.animate({height:e(c.last())},b.animation_duration,g)},g=function(){switch(a.data("collapsed")){case !0:a.css({height:"auto"});a.trigger("afterCollapse");break;case !1:a.css({height:"auto"}),a.trigger("afterExpand")}};f.on("click",function(){switch(a.data("collapsed")){case !0:a.trigger("beforeExpand");a.data("collapsed",!1).removeClass(b.wrapper_collapsed_class);
$(this).text(b.button_text_collapse);l();break;case !1:a.trigger("beforeCollapse"),a.data("collapsed",!0).addClass(b.wrapper_collapsed_class),$(this).text(b.button_text_expand),k()}})}}});